#!/bin/sh

#LH_NO_EDIT is used in my nvim config to say, dont edit just exit with an error to let nvim handle the editing

link="$*"

mime=$(file --mime-type "$*" | cut -d: -f2 | tr -d ' ')

#website="$(printf "%s" "$link" | grep -Po "://.*?/" | sed -E 's/(:\/)?\///g')"

case "$mime" in
    image/*) sxiv "$link"; exit 0 ;;
    text/*|plain/*)
        [ $LH_NO_EDIT = 1 ] && exit 1
        $TERMINAL $EDITOR "$link"; exit 0 ;;
    video/*|audio/*) mpv "$link"; exit 0 ;;
    application/x-shockwave-flash) flashplayer "$link"; exit 0 ;;
esac
case "$link" in
    file://*|/*|~/*|./*)
        [ $LH_NO_EDIT = 1 ] && exit 1
        $TERMINAL $EDITOR "$link" ;;
    *.swf) flashplayer "$link" ;;
    *.png|*.jpg|*.jpeg|*.webm|*.gif|*.webm|*.webp) mpv --loop "$link" & ;;
    term://*) "${TERMINAL}" "${TERMINAL_HOLD_OPT:="-H"}" -e "${link#term://}";;
    https://cdn.discordapp.com/attachments/*)
        tmp=$(mktemp)
        curl "$link" > "$tmp"
        linkhandler "$tmp"
        rm "$tmp" ;;
    https://github.com/*/blob/*)
        [ $LH_NO_EDIT = 1 ] && exit 1
        file_path=${link#*/blob/}
        repo="${link%%/blob/*}"
        repo="${repo#https://github.com/}"
        "${TERMINAL}" $EDITOR "https://raw.githubusercontent.com/${repo}/${file_path}" ;;
    *)
        if yt-dlp -s "$link" > /dev/null 2>&1; then
            nohup mpv --geometry=1000 --loop "$link" > /dev/null 2>&1 &
        else
            nohup $BROWSER_LITE "$link" > /dev/null 2>&1 &
        fi;;
esac
